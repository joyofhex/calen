#!/usr/bin/env ruby

require 'logging'
require 'yaml'
require 'time'
require 'optparse'
require 'pry'
require 'chronic_duration'

require 'calen/app/dayview'
require 'calen/app/freerooms'
require 'exchange_gateway'

require 'options'

logger = Logging.logger(STDOUT)
logger.level = :warn

option_parser = Options.new
options = option_parser.parse(ARGV)

endpoint = 'https://webmail.tomtomgroup.com/ews/Exchange.asmx'
settings = YAML.load_file File.expand_path('~/.jira')

ex = ExchangeGateway.new(endpoint, settings)

MODE_TO_APP_CLASS_MAP = {
  dayview: Calen::App::Dayview,
  freerooms: Calen::App::FreeRooms,
}

app = MODE_TO_APP_CLASS_MAP[options.mode].new
app.run(options, ex)
